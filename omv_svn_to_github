#!/bin/bash

log_file="/home/aaron/omv.log"

# svn checkout with branches command
# svn checkout svn://svn.code.sf.net/p/openmediavault/code

# change to code directory
cd /media/12370cfe-0445-4a92-915d-74992edee16e/plugins/openmediavault-code

# get current revision
revision=$(svn info | grep "Revision:" | cut -f2 -d":" | tr -d " ")

# update svn repo and get new revision
svn update
newrevision=$(svn info | grep "Revision:" | cut -f2 -d":" | tr -d " ")

# make history file for easier viewing on github
svn log -l 100 > ../history.log

# remove .git dir from shairport
rm -rfv branches/1.x/deb/shairport/shairport/.git

if [ $revision != $newrevision ]; then
  cd ..

  # add changed files to git
  git add *
  # $(git ls-files --modified)

  # remove deleted files
  git rm $(git ls-files --deleted)

  # create commit
  git commit -m "update to revision $newrevision"

  # push to github
  git push

  echo "Updated to $newrevision" >> ${log_file}
else
  echo "No updates." >> ${log_file}
fi

cd /media/12370cfe-0445-4a92-915d-74992edee16e/plugins/openmediavault-code
git status
